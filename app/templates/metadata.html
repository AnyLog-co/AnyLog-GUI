



{% extends "base.html" %}

{% block content %}

<script LANGUAGE="JavaScript">
<!--
function confirm_selection()
{
var agree=confirm("Are you sure you wish to continue?");
if (agree)
 return true ;
else
 return false ;
}
// -->
<!--
function get_file_name()
{
var file_name=prompt("New file name:");
return file_name
}
// -->
</script>

{% if selection %}

<!-- Add the usr path to the form (if provided)  -->
<form action="{{url_for('metadata')}}/{{selection}}" method="POST">
{% else %}
<form action="{{url_for('metadata')}}" method="POST">
{% endif %}

    {% if map_url %}
        <iframe src="{{ map_url }}" width="850" height="550" frameborder="10" align="right" class="nodes-map"></iframe>
    {% endif %}


<ul class="tree">

    {% for node in nodes_list %}

        {% if node %}        <!--  The node is not None   -->

                {% if node.first_child %}
                    <ul>        <!--  Start unordered list   -->
                {% endif %}

                <!--  List Item starts  -->
                {% if node.last_child  %}
                    <li class="last">
                {% else %}
                    <li>
                {% endif %}

                {% if node.scroll_location %}
                            <!-- The position of the scroll when page is loaded  -->
                            <a name="start_location"></a>
                {% endif %}

                {% if node.name  %}


                        {% if node.report  %}
                            <!-- Option to rename update or delete a report -->
                            <input type="submit" value="Update" name="{{node.path}}" class="button_update">
                            <input type="submit" value="Rename" name="{{node.path}}" class="button_rename">
                            <input type="submit" value="Delete" name="{{node.path}}" class="button_delete">

                        {% elif node.folder  %}
                            <!-- Option to rename or delete a folder -->
                            <input type="submit" value="Rename" name="folder.{{node.path}}" class="button_rename" onclick="get_file_name()">
                            <input type="submit" value="Delete" name="folder.{{node.path}}" class="button_delete" onclick="confirm_selection()">
                        {% elif node.details  %}
                            <!-- View Policy or Select or Navigate  -->
                            <!-- View details of a policy - nothing selected - transfer the path to the node with the policy to view -->
                            <input type="submit" value="View" name="{{node.path}}" class="button_view">
                        {% endif %}
                        {% if selection  %}
                             {% if node.report  %}
                                 <!-- Flag to select the report (for multiple reports viewed) -->
                                <td><input type=checkbox name=selected.{{node.path}}@{{node.name}}></td>
                                <!-- Or go directly to a report -->
                                <a href="{{url_for('metadata')}}/{{selection}}?report={{node.url}}">{{node.name}}</a>

                            {% elif node.dbms_name  %}
                                <!-- Flag to select the edge (to Save for a future report or immediate report) -->
                                <td><input type=checkbox name=selected.{{node.dbms_name}}@{{node.table_name}}@{{node.id}}></td>
                                <!-- Or go directly to a report -->
                                <a href="{{url_for('metadata')}}/{{selection}}?report={{node.dbms_name}}@{{node.table_name}}@{{node.id}}?">{{node.name}}</a>
                            {% else %}
                                <!-- Not Edge -->
                                {% if node.id  %}
                                    <a href="{{url_for('metadata')}}/{{node.path}}">{{node.name}}</a>
                                {% else %}
                                        {% if node.option  %}
                                            <!-- A node representing navigation selection based on the config file -->
                                            <!-- Moving from metadata (option from config) to data node -->
                                            <input type="submit" value="{{node.option}}" name="option.{{node.path}}">
                                        {% else %}
                                            <a href="{{url_for('metadata')}}/{{node.path}}">{{node.name}}</a>
                                        {% endif %}
                                {% endif %}

                            {% endif %}
                            {% if node.data_struct %}
                            <!-- Message received from the network -->
                                <ul>        <!--  Start unordered list   -->

                                {% for data_line in node.data_struct %}
                                     <li>
                                    {% if data_line[1] %}
                                        <!--  transformed text to attr value pairs separated by colon   -->
                                        <span style="color: #140d84">
                                        {{data_line[0]}}&nbsp : &nbsp
                                        </span>
                                        <span style="color: black">
                                        {{data_line[1]}}
                                        </span>
                                    {% else %}
                                        <span style="color: black">
                                        {{data_line[0]}}
                                        </span>
                                    {% endif %}
                                    </li>
                                {%  endfor %}

                                </ul>        <!--  Start unordered list   -->
                            {% endif %}
                        {% else %}
                            <a href="{{url_for('metadata')}}/{{node.path}}">{{node.name}}</a>
                        {% endif %}
                {% elif node.json_key %}
                         <!-- View a policy (key and value)  -->
                        <span id="json" style="color: #140d84">{{node.json_key}}</span>
                        {% if node.json_value  %}
                            <span id="json" style="color: black"> : {{node.json_value}}</span>
                        {% endif %}
                {% endif %}

                {% if node.with_children %}

                {% else %}
                    </li>
                {% endif %}

        {% else %}
             <!--  Node is None - end of list -->
                </li>
                </ul>
        {% endif %}
    {% endfor %}

    <br>

     <!-- If edge nodes that can be selected to a report -->
        {% if location_key %}
            <hr>
        <input type="submit" value="Configure" name="Configure">    <!-- Configure report -->
        <input type="submit" value="Select" name="Select">    <!-- Selected edge to a new report -->
        <input type="submit" value="Report" name="Report">   <!-- Take selected edge to report -->
        {% endif %}
</ul>

<!-- Change scroll location from the top of the screen to last node touched-->
<script> window.location.hash="start_location"; </script>

{% endblock %}
